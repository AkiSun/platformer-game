# 实施计划：Godot Engine 平台跳跃游戏 Demo

## 1. 项目概述

### 1.1 项目目标
开发一个基于 Godot Engine 4.x 的平台跳跃游戏 Demo，支持 PC 和手机双端操作，具备完整的核心玩法、角色能力、敌人 AI 和视觉效果。

### 1.2 范围
- **包含**：核心玩法、角色系统、敌人 AI、平台设计、UI 界面、视差背景
- **不包含**：多人模式、关卡编辑器、存档系统

### 1.3 技术约束
- Godot Engine 4.x
- 响应式设计（PC + 手机）
- 60fps 流畅运行
- Web 导出 + GitHub Pages 部署

---

## 2. 技术方案

### 2.1 Godot 节点架构

```
┌─────────────────────────────────────────────────────────┐
│                    Main (主场景)                          │
│  ┌─────────────────────────────────────────────────────┐│
│  │  Node2D - GameManager (游戏管理器)                   ││
│  │    ├── GameState (游戏状态枚举)                      ││
│  │    ├── EnemyManager (敌人生成器)                     ││
│  │    └── ScoreManager (分数管理)                       ││
│  └─────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────┐│
│  │  ParallaxBackground (视差背景)                       ││
│  │    ├── Sprite2D (天空层 0.1x)                       ││
│  │    ├── Sprite2D (远景层 0.3x)                       ││
│  │    └── Sprite2D (近景层 0.5x)                       ││
│  └─────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────┐│
│  │  TileMapLayer (平台层)                              ││
│  │    ├── StaticBody2D (地面)                         ││
│  │    ├── StaticBody2D (斜坡)                         ││
│  │    └── Area2D (浮空平台触发)                        ││
│  └─────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────┐│
│  │  Node2D - Ladders (梯子组)                          ││
│  └─────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────┐│
│  │  CharacterBody2D - Player (玩家角色)                ││
│  │    ├── CollisionShape2D                            ││
│  │    ├── AnimatedSprite2D                            ││
│  │    └── ProgressBar (血条)                          ││
│  └─────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────┐│
│  │  Node2D - Enemies (敌人容器)                        ││
│  └─────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────┐│
│  │  Camera2D (摄像机)                                  ││
│  └─────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────┐│
│  │  CanvasLayer - UI (UI 层)                           ││
│  │    ├── Control - GameHUD                           ││
│  │    ├── Control - VictoryScreen                     ││
│  │    └── Control - DefeatScreen                      ││
│  └─────────────────────────────────────────────────────┘│
│  ┌─────────────────────────────────────────────────────┐│
│  │  CanvasLayer - TouchControls (触屏控制)             ││
│  └─────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────┘
```

### 2.2 项目文件结构

```
platformer-game/
├── project.godot              # Godot 项目配置文件
├── export_presets.cfg         # 导出配置
├── icon.svg                   # 项目图标
├── assets/
│   ├── sprites/
│   │   ├── player/            # 玩家精灵序列
│   │   ├── enemy/             # 敌人精灵序列
│   │   ├── tileset/          # 瓦片集
│   │   └── ui/                # UI 按钮图片
│   ├── sounds/                # 音效资源
│   └── fonts/                 # 字体资源
├── scenes/
│   ├── Main.tscn              # 主游戏场景
│   ├── Player.tscn            # 玩家角色场景
│   ├── Enemy.tscn             # 敌人场景
│   ├── Platform.tscn          # 平台场景
│   ├── Ladder.tscn            # 梯子场景
│   ├── Background.tscn        # 背景场景
│   └── UI/
│       ├── GameUI.tscn        # 游戏 UI 场景
│       ├── VictoryScreen.tscn # 胜利界面
│       ├── DefeatScreen.tscn  # 失败界面
│       └── TouchControls.tscn # 触屏控制
├── scripts/
│   ├── Main.gd
│   ├── Player.gd
│   ├── Enemy.gd
│   ├── EnemyManager.gd
│   ├── Platform.gd
│   ├── Ladder.gd
│   ├── Camera2D.gd
│   ├── ParallaxBackground.gd
│   └── UIManager.gd
└── export/
    └── web/                    # Web 导出目录
```

### 2.3 关键技术决策

| 决策点 | 选择 | 理由 |
|--------|------|------|
| 引擎版本 | Godot 4.x | 最新版本，功能强大 |
| 渲染模式 | 2D (Canvas) | Web 兼容性更好 |
| 玩家节点 | CharacterBody2D | 内置物理和移动系统 |
| 平台节点 | StaticBody2D + TileMap | 高效的碰撞和编辑 |
| 敌人节点 | CharacterBody2D | 可复用的移动 AI |
| 动画 | AnimatedSprite2D | 序列帧动画支持 |
| UI | Control 节点 | 响应式布局 |
| 输入 | InputMap | 统一的输入映射 |

### 2.4 核心系统设计

1. **物理系统**
   - 使用 Godot 内置 `PhysicsServer2D`
   - 重力通过 `ProjectSettings` 配置
   - 移动使用 `move_and_slide()`

2. **碰撞检测**
   - `CollisionShape2D` 定义碰撞区域
   - `move_and_slide()` 自动处理碰撞
   - `Area2D` 检测触发区域（敌人视野、攻击范围）

3. **敌人 AI**
   - 状态机：PATROL → CHASE → ATTACK
   - `RayCast2D` 检测墙壁和平台边缘
   - `NavigationRegion2D` 路径导航（可选）

4. **视差背景**
   - `ParallaxLayer` 节点
   - 根据摄像机位置计算偏移

5. **输入系统**
   - `InputMap` 定义动作（move_left, jump, dash, attack）
   - 键盘映射 + 触屏按钮

---

## 3. 开发阶段划分

### 阶段一：项目初始化（2 天）

**目标**：创建 Godot 项目，配置基础设置

- [ ] 创建 Godot 项目，配置 `project.godot`
- [ ] 设置项目分辨率和显示模式
- [ ] 配置 `InputMap` 输入映射
- [ ] 创建基础场景结构
- [ ] 配置 Web 导出预设

### 阶段二：玩家角色（3-4 天）

**目标**：实现完整的玩家角色系统

- [ ] 创建 Player 场景（CharacterBody2D）
- [ ] 实现移动和跳跃
- [ ] 实现冲刺和无敌帧
- [ ] 实现攻击系统
- [ ] 集成血条（ProgressBar）
- [ ] 添加动画（AnimatedSprite2D）
- [ ] 触屏虚拟按钮集成

### 阶段三：平台与环境（2-3 天）

**目标**：实现平台、梯子等环境元素

- [ ] 创建 TileMap 瓦片集
- [ ] 设计关卡布局（地面、浮空平台、斜坡）
- [ ] 实现梯子系统
- [ ] 平台交互优化（磕头、下跳、爬梯）
- [ ] 摄像机跟随（Camera2D）

### 阶段四：敌人系统（3-4 天）

**目标**：实现敌人 AI 和敌人生成

- [ ] 创建 Enemy 场景
- [ ] 实现巡逻模式 AI
- [ ] 实现追击模式 AI
- [ ] 创建 EnemyManager 敌人生成器
- [ ] 5 个敌人波次逻辑
- [ ] 敌人血条显示

### 阶段五：视差背景（2 天）

**目标**：实现多层视差滚动背景

- [ ] 设计背景层（天空、远景、中景、近景）
- [ ] 实现 ParallaxBackground 脚本
- [ ] 集成视觉资源

### 阶段六：UI 与游戏流程（2 天）

**目标**：实现游戏 UI 和胜负流程

- [ ] 创建 GameUI 场景
- [ ] 实现胜利界面
- [ ] 实现失败界面
- [ ] 实现重新开始功能
- [ ] 集成触屏控制 UI

### 阶段七：测试与优化（2-3 天）

**目标**：全面测试和性能优化

- [ ] 功能测试（所有验收标准）
- [ ] 跨平台测试（PC + 手机）
- [ ] 性能优化（60fps 保证）
- [ ] Bug 修复
- [ ] Web 导出测试

---

## 4. 里程碑

### 里程碑 1：项目初始化
**时间**：第 1 周前期  
**交付物**：可运行的项目框架，基础场景结构

### 里程碑 2：角色可用
**时间**：第 1 周周末  
**交付物**：玩家角色可移动、跳跃、冲刺、攻击

### 里程碑 3：环境完整
**时间**：第 2 周中期  
**交付物**：平台、梯子、摄像机正常工作

### 里程碑 4：敌人系统
**时间**：第 2 周周末  
**交付物**：敌人生成、AI 行为、战斗系统完整

### 里程碑 5：完整 Demo
**时间**：第 3 周中期  
**交付物**：完整的游戏 Demo，所有功能可用

### 里程碑 6：上线部署
**时间**：第 3 周周末  
**交付物**：Web 导出完成，GitHub Pages 可访问

---

## 5. 风险评估

| 风险 | 可能性 | 影响 | 对策 |
|------|--------|------|------|
| Godot 版本兼容性 | 低 | 中 | 使用稳定版本 4.x |
| Web 导出性能 | 中 | 中 | 优化渲染、使用 Canvas 模式 |
| 碰撞检测问题 | 中 | 中 | 充分测试、使用调试工具 |
| 手机端兼容性 | 中 | 中 | 响应式设计、触屏测试 |
| 资源导入问题 | 低 | 中 | 遵循 Godot 资源规范 |

---

## 6. 验收标准

### 核心玩法
- ✅ 玩家可以左右移动、跳跃、冲刺、攻击
- ✅ 5 秒后生成第 1 个敌人，击败后立即生成下一个
- ✅ 共 5 个敌人，全部击败则胜利
- ✅ 玩家血量归 0 则失败

### 操控
- ✅ PC 端键盘操作正常
- ✅ 手机端虚拟按钮正常

### 视觉效果
- ✅ 简约卡通风格
- ✅ 视差滚动背景（4 层）
- ✅ 角色和敌人有动画

### 技术
- ✅ 60fps 流畅运行
- ✅ 响应式适配不同屏幕
- ✅ GitHub Pages 可访问

---

## 7. 资源需求

### 人力
- 开发者：dev-agent（全栈）

### 工具
- 引擎：Godot 4.x
- 代码编辑器：VS Code
- Git 版本控制
- GitHub Pages 部署

### 时间估算
- 总工时：约 16-21 天
- 每日工作：4-6 小时

---

> **计划制定日期**：2026-02-14  
> **计划版本**：2.0（Godot Engine）
